<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rafiah Dune Adventure</title>
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      html, body {
        height: 100%;
        margin: 0;
        background: #0d0d0d;
        color: #f0f0f0;
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
      }
      canvas {
        display: block;
        margin: 0 auto;
        image-rendering: pixelated;
        touch-action: none;
      }
      noscript {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.9);
        color: #f8f8f8;
        font-size: 1.2rem;
        z-index: 2147483647;
      }
      #rafiah-debug {
        position: fixed;
        left: 8px;
        bottom: 8px;
        z-index: 2147483647;
        max-width: 60vw;
        max-height: 40vh;
        overflow: auto;
        font: 12px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        background: rgba(0, 0, 0, 0.75);
        color: #0f0;
        padding: 8px;
        border: 1px solid #0f0;
        border-radius: 6px;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <noscript>ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª Ù„ØªØ¬Ø±Ø¨Ø© Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø·Ø¹ÙˆØ³.</noscript>
    <div id="rafiah-debug" hidden></div>
    <script
      defer
      data-phaser-cdn
      src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"
      integrity="sha384-MBgGgVk6odd6JDACUtJ/xCNIUmhCSwN8FklarIYURiDZ6G7uMR2ykZXN0jQTZ8b/"
      crossorigin="anonymous"
    ></script>
    <script>
      (function rafiahBoot() {
        const debugBox = document.getElementById('rafiah-debug');
        function log(...args) {
          const line = args.map(part => {
            if (typeof part === 'string') return part;
            try { return JSON.stringify(part); } catch (_) { return String(part); }
          }).join(' ');
          console.log(...args);
          if (debugBox) {
            debugBox.hidden = false;
            debugBox.append(line + '\n');
            debugBox.scrollTop = debugBox.scrollHeight;
          }
        }
        let bootStarted = false;
        function importMain() {
          if (bootStarted) return;
          bootStarted = true;
          import('./main.js?v=20241201')
            .then(() => log('âœ… Boot: main.js imported'))
            .catch(err => log('âŒ Boot import failed', err));
        }
        log('â³ Waiting for Phaser (CDN) ...');
        const cdn = document.querySelector('script[data-phaser-cdn]');
        if (cdn) {
          cdn.addEventListener('load', () => {
            log('âœ… Phaser CDN script loaded');
            if (window.Phaser) startWhenReady();
          });
          cdn.addEventListener('error', () => {
            log('âš ï¸ Phaser CDN failed to load from jsDelivr, attempting fallbackâ€¦');
            const fallback = document.createElement('script');
            fallback.defer = true;
            fallback.src = 'https://unpkg.com/phaser@3.70.0/dist/phaser.min.js';
            fallback.addEventListener('load', () => {
              log('âœ… Phaser fallback CDN loaded');
              if (window.Phaser) startWhenReady();
            });
            fallback.addEventListener('error', () => log('ğŸ’¥ Phaser fallback CDN load failed'));
            document.head.appendChild(fallback);
          });
        } else {
          log('âš ï¸ Phaser CDN script tag not found');
        }
        function startWhenReady() {
          if (window.Phaser) {
            log('âœ… Phaser ready (window.Phaser found)');
            importMain();
            return true;
          }
          return false;
        }
        (function poll() {
          if (startWhenReady()) return;
          setTimeout(poll, 50);
        })();
        window.addEventListener('error', ev => log('ğŸ’¥ window.onerror:', ev.message || ev.type));
        window.addEventListener('unhandledrejection', ev => log('ğŸ’¥ unhandledrejection:', String(ev.reason || ev)));
      })();
    </script>
  </body>
</html>
