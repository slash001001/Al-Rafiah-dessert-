var R=Object.defineProperty;var B=(o,e,t)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var d=(o,e,t)=>B(o,typeof e!="symbol"?e+"":e,t);import{P as h}from"./vendor-0RJB29YE.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class v extends h.Scene{constructor(){super("MenuScene")}create(){var s;this.createBackground(),this.add.text(this.scale.width/2,this.scale.height/2-80,"Hill-Climb Rally",{fontFamily:"monospace",fontSize:"48px",color:"#fefefe"}).setOrigin(.5),this.add.text(this.scale.width/2,this.scale.height/2,"Powered by Phaser 3 + Matter (yandeu ref)",{fontFamily:"monospace",fontSize:"18px",color:"#a0c7ff"}).setOrigin(.5);const e=this.add.text(this.scale.width/2,this.scale.height/2+80,"Press SPACE / click to start",{fontFamily:"monospace",fontSize:"20px",color:"#ffd166"}).setOrigin(.5);this.tweens.add({targets:e,alpha:.3,yoyo:!0,repeat:-1,duration:900});const t=()=>this.scene.start("HillClimbScene");(s=this.input.keyboard)==null||s.once("keydown-SPACE",t),this.input.on("pointerdown",t)}createBackground(){const e=this.add.graphics();e.fillGradientStyle(1056832,1254477,16234291,16227685,1),e.fillRect(0,0,this.scale.width,this.scale.height)}}class A{constructor(e){d(this,"text");d(this,"banner");this.scene=e,this.text=e.add.text(16,16,"",{fontFamily:"monospace",fontSize:"18px",color:"#ffffff"}).setScrollFactor(0),this.banner=e.add.text(e.scale.width/2,20,"",{fontFamily:"monospace",fontSize:"20px",color:"#ffd166"}).setOrigin(.5,0).setScrollFactor(0)}update(e){const t=Math.max(0,e.fuel),s=Math.max(0,e.distance),i=Math.max(0,e.timeLeft);this.text.setText(`Fuel: ${t.toFixed(0)}%
Distance: ${s.toFixed(0)} / ${e.target.toFixed(0)} m
Coins: ${e.coins}
Sunset: ${i.toFixed(1)}s`)}showBanner(e){this.banner.setText(e),this.banner.alpha=1,this.scene.tweens.add({targets:this.banner,alpha:.3,yoyo:!0,duration:500,repeat:-1})}}function O(o,e,t){E(o);const s=140,i=34,n=26,r=60,u=40,p=h.Physics.Matter.Matter,l=o.matter.add.image(e,t,"car-body",void 0,{label:"car-chassis"}),m=p.Bodies.rectangle(e,t,s,i,{chamfer:{radius:8}});l.setExistingBody(m),l.setFriction(.9).setFrictionAir(.02).setDensity(.0016);const y={friction:1,frictionStatic:1,frictionAir:.001,density:.0012,restitution:.05},c=o.matter.add.image(e-r,t+20,"car-wheel",void 0,{...y,label:"car-wheel"});c.setCircle(n);const a=o.matter.add.image(e+r,t+20,"car-wheel",void 0,{...y,label:"car-wheel"});a.setCircle(n),o.matter.add.constraint(l.body,c.body,u,.32,{pointA:{x:-r,y:10},pointB:{x:0,y:0}}),o.matter.add.constraint(l.body,c.body,u,.15,{pointA:{x:-r,y:-10},pointB:{x:0,y:0}}),o.matter.add.constraint(l.body,a.body,u,.32,{pointA:{x:r,y:10},pointB:{x:0,y:0}}),o.matter.add.constraint(l.body,a.body,u,.15,{pointA:{x:r,y:-10},pointB:{x:0,y:0}});const f=.35,x=9e-4,k=g=>{const C=S()>20?.55:1,P=x*g*C;[c,a].forEach(T=>{if(!T.body)return;const D=T.body.angularVelocity+P,L=h.Math.Clamp(D,-f,f);p.Body.setAngularVelocity(T.body,L)})},S=()=>{const g=l.body.velocity;return Math.hypot(g.x,g.y)*60};return{chassis:l,wheels:[c,a],drive:k,getSpeed:S,getX:()=>l.x,getY:()=>l.y,getTilt:()=>l.rotation}}function E(o){if(o.textures.exists("car-body"))return;const e=o.add.graphics();e.fillStyle(3429585,1),e.fillRoundedRect(0,0,140,34,8),e.lineStyle(3,793165,.9),e.strokeRoundedRect(0,0,140,34,8),e.fillStyle(793165,.9),e.fillRoundedRect(16,4,50,18,6),e.generateTexture("car-body",140,34),e.clear(),e.fillStyle(2236962,1),e.fillCircle(30,30,30),e.lineStyle(4,15858414,1),e.strokeCircle(30,30,30),e.fillStyle(16777215,1),e.fillCircle(30,30,10),e.generateTexture("car-wheel",60,60),e.destroy()}function H(o,e){const{length:t,segmentLength:s,baseHeight:i,amplitude:n}=e,r=[],u=()=>h.Math.FloatBetween(-n*.35,n*.35);let p=i;for(let a=0;a<=t;a+=s){const f=Math.sin(a*.0015)*n*.6+Math.sin(a*7e-4)*n*.3;p=h.Math.Clamp(i+f+u(),i-n,i+n),r.push(new h.Math.Vector2(a,p))}const l=80,m=o.matter,y=h.Physics.Matter.Matter;for(let a=0;a<r.length-1;a++){const f=r[a],x=r[a+1],k=(f.x+x.x)/2,S=(f.y+x.y)/2,b=x.x-f.x,g=x.y-f.y,M=Math.sqrt(b*b+g*g),C=Math.atan2(g,b),P=y.Bodies.rectangle(k,S,M,l,{isStatic:!0,angle:C,friction:1,frictionStatic:1,restitution:0,label:"terrain"});m.world.add(P)}const c=o.add.graphics();return c.fillStyle(4009763,1),c.beginPath(),c.moveTo(0,o.scale.height+200),r.forEach(a=>c.lineTo(a.x,a.y)),c.lineTo(r[r.length-1].x,o.scale.height+200),c.closePath(),c.fillPath(),c.lineStyle(4,8018746,.8),c.beginPath(),c.moveTo(r[0].x,r[0].y-2),r.forEach(a=>c.lineTo(a.x,a.y-2)),c.strokePath(),c.setDepth(-1),o.matter.world.setBounds(0,0,t+800,o.scale.height+500,64,!0,!0,!0,!0),{points:r,totalLength:r[r.length-1].x}}function F(o,e){const t=o.points;if(e<=t[0].x)return t[0].y;if(e>=t[t.length-1].x)return t[t.length-1].y;for(let s=0;s<t.length-1;s++){const i=t[s],n=t[s+1];if(e>=i.x&&e<=n.x){const r=(e-i.x)/(n.x-i.x);return h.Math.Linear(i.y,n.y,r)}}return t[t.length-1].y}class X extends h.Scene{constructor(){super("HillClimbScene");d(this,"car");d(this,"hud");d(this,"terrain");d(this,"keys");d(this,"fuel",100);d(this,"coins",0);d(this,"timeLeft",225);d(this,"targetDistance",1500);d(this,"startX",120);d(this,"ended",!1);d(this,"pickups",[])}create(){var i;this.ended=!1,this.fuel=100,this.coins=0,this.timeLeft=225,this.addSky(),this.createPickupTextures(),this.terrain=H(this,{length:2e3,segmentLength:70,baseHeight:this.scale.height*.7,amplitude:140}),this.spawnPickups();const t=F(this.terrain,this.startX)-90;this.car=O(this,this.startX,t);const s=this.cameras.main;s.setBackgroundColor("#0d1021"),s.startFollow(this.car.chassis,!0,.08,.08,-300,120),s.setBounds(0,0,this.terrain.totalLength+500,this.scale.height+200),this.createSun(),this.hud=new A(this),this.hud.showBanner("Climb before sunset. Arrows / A-D to drive."),this.hud.update({fuel:this.fuel,distance:0,target:this.targetDistance,coins:this.coins,timeLeft:this.timeLeft}),this.keys=(i=this.input.keyboard)==null?void 0:i.addKeys({left:"LEFT",right:"RIGHT",a:"A",d:"D"}),this.matter.world.on("collisionstart",this.handleCollision,this),this.events.once(h.Scenes.Events.SHUTDOWN,()=>{this.matter.world.off("collisionstart",this.handleCollision,this)})}update(t,s){if(this.ended)return;const i=s/1e3,n=this.getInputDirection();n!==0&&this.fuel>0&&(this.car.drive(n),this.fuel=Math.max(0,this.fuel-9*i)),this.timeLeft=Math.max(0,this.timeLeft-i);const r=Math.max(0,this.car.getX()-this.startX);if(this.hud.update({fuel:this.fuel,distance:r,target:this.targetDistance,coins:this.coins,timeLeft:this.timeLeft}),this.timeLeft<=0)return this.endRun("fail");if(r>=this.targetDistance)return this.endRun("win");if(this.car.getY()>this.scale.height+600)return this.endRun("fail");const u=h.Math.RadToDeg(this.car.getTilt());if(Math.abs(u)>120&&this.car.getSpeed()<2)return this.endRun("fail")}getInputDirection(){var i,n,r,u,p,l,m,y;const t=((n=(i=this.keys)==null?void 0:i.left)==null?void 0:n.isDown)||((u=(r=this.keys)==null?void 0:r.a)==null?void 0:u.isDown),s=((l=(p=this.keys)==null?void 0:p.right)==null?void 0:l.isDown)||((y=(m=this.keys)==null?void 0:m.d)==null?void 0:y.isDown);return t&&!s?-1:s&&!t?1:0}handleCollision(t){for(const s of t.pairs)this.tryPickup(s.bodyA,s.bodyB),this.tryPickup(s.bodyB,s.bodyA)}tryPickup(t,s){const i=t.gameObject,n=i==null?void 0:i.getData("pickup");n&&i&&this.isCarBody(s)&&(n==="fuel"&&this.collectFuel(i),n==="coin"&&this.collectCoin(i))}collectFuel(t){this.fuel=Math.min(100,this.fuel+45),this.fadePickup(t)}collectCoin(t){this.coins+=1,this.fadePickup(t)}fadePickup(t){t.body&&this.matter.world.remove(t.body),this.tweens.add({targets:t,alpha:0,scale:1.4,duration:250,onComplete:()=>t.destroy()})}isCarBody(t){return t?t.label==="car-chassis"||t.label==="car-wheel":!1}endRun(t){if(this.ended)return;this.ended=!0;const s={result:t,distance:Math.max(0,this.car.getX()-this.startX),coins:this.coins,fuel:this.fuel};this.scene.start("CampScene",s)}addSky(){const t=this.add.graphics();t.fillGradientStyle(791616,1121362,15965202,16374134,1),t.fillRect(0,0,this.scale.width,this.scale.height),t.setScrollFactor(0),t.setDepth(-10)}createSun(){const t=this.add.circle(140,120,60,16374134,.8);t.setScrollFactor(.2),t.setDepth(-5)}createPickupTextures(){if(!this.textures.exists("pickup-fuel")){const t=this.add.graphics();t.fillStyle(16739179,1),t.fillRoundedRect(0,0,34,44,6),t.fillStyle(16777215,1),t.fillTriangle(10,30,17,12,24,30),t.generateTexture("pickup-fuel",34,44),t.clear(),t.fillStyle(16761600,1),t.fillCircle(16,16,16),t.lineStyle(3,16777215,1),t.strokeCircle(16,16,16),t.generateTexture("pickup-coin",32,32),t.destroy()}}spawnPickups(){const t=this.terrain;for(let s=420;s<t.totalLength-100;s+=320){const i=F(t,s)-60,n=this.matter.add.sprite(s,i,"pickup-coin",void 0,{isStatic:!0,isSensor:!0,label:"pickup-coin"});n.setData("pickup","coin"),n.setDepth(2),this.pickups.push(n)}for(let s=700;s<t.totalLength-200;s+=520){const i=F(t,s)-70,n=this.matter.add.sprite(s,i,"pickup-fuel",void 0,{isStatic:!0,isSensor:!0,label:"pickup-fuel"});n.setData("pickup","fuel"),n.setDepth(2),this.pickups.push(n)}}}class $ extends h.Scene{constructor(){super("CampScene")}create(e){var r;this.cameras.main.setBackgroundColor("#0c1024");const t=e.result==="win"?"VICTORY! Reached the ridge.":"Night fell. Try again!";this.add.text(this.scale.width/2,this.scale.height/2-60,t,{fontFamily:"monospace",fontSize:"36px",color:"#ffd166"}).setOrigin(.5);const s=`Distance: ${e.distance.toFixed(0)} m
Coins: ${e.coins}
Fuel left: ${e.fuel.toFixed(0)}%`;this.add.text(this.scale.width/2,this.scale.height/2+10,s,{fontFamily:"monospace",fontSize:"20px",color:"#a0c7ff",align:"center"}).setOrigin(.5);const i=this.add.text(this.scale.width/2,this.scale.height/2+120,"Press SPACE / click to restart",{fontFamily:"monospace",fontSize:"18px",color:"#ffffff"}).setOrigin(.5);this.tweens.add({targets:i,alpha:.4,yoyo:!0,repeat:-1,duration:600});const n=()=>this.scene.start("HillClimbScene");(r=this.input.keyboard)==null||r.once("keydown-SPACE",n),this.input.on("pointerdown",n)}}const z={type:h.AUTO,parent:"app",backgroundColor:"#0d1021",scale:{mode:h.Scale.FIT,autoCenter:h.Scale.CENTER_BOTH,width:1280,height:720},physics:{default:"matter",matter:{gravity:{x:0,y:1.25},debug:!1}},scene:[v,X,$]},I=["service","Worker",`${Date.now()}`].slice(0,2).join(""),N=navigator,w=N[I];w!=null&&w.getRegistrations&&w.getRegistrations().then(o=>o.forEach(e=>e.unregister())).catch(()=>{});new h.Game(z);
